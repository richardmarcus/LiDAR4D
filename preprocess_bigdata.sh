#! /bin/bash

#exit on errer
set -e
SCENE_IDs="0000" #0002 0003 0004 0005 0006 0007 0009" # 0010"

#SEQ_IDs0000="250 500 750 1322 1572 1822 2072 2322 2572 2822 3072 3322 3572 3822 4072 4360 4610 4860 5110 5371 5932 6182 6432 6682 6932 7182 7432 7682 7932 8201 8451 8701 8951 9609 9859 10109 10375 10625 10875 11143"
SEQ_IDs0000="1538 1728 1908 3353 2350 4950 8120 10200 10750 11400"
SEQ_IDs0002="4391 4641 4891 5209 5459 5975 6225 6475 6771 7021 7271 7528 7778 8028 8278 8562 8812 9148 9398 9648 9940 10239 10489 10797 11047 11635 11885 12135 12385 12635 12885 13177 13498 13748 13998 14248 14498 14748 14998 15248 15498 15748"
SEQ_IDs0003="272 397 522 647 772 897"
SEQ_IDs0004="2914 3164 3414 3997 4247 4497 4785 5035 5285 5620 5870 6120 6408 6669 6919 7169 7419 7669 7919 8169 8419 8669 8919 9169 9419 9669 9996 10246 10496 10746 10996"
SEQ_IDs0005="286 536 815 1138 1388 1638 1888 2138 2388 2638 2888 3138 3445 3695 4018 4287 4537 4787 5037 5311 5580 6142 6392"
SEQ_IDs0006="347 649 899 1149 1399 1649 1899 2149 2399 2738 2988 3238 3757 4007 4257 4569 4819 5069 5319 5764 6014 6264 6514 6764 7014 7264 7514 7764 8014 8264 8514 8764 9014 9264"
SEQ_IDs0007="2 252 502 752 1002 1252 1502 1752 2310 2739"
SEQ_IDs0009="335 586 836 1091 1341 1591 1864 2114 2364 2614 2864 3114 3364 3614 3864 4114 4364 4614 4978 5238 5488 5738 5988 6238 6488 6738 6988 7238 7488 8022 8273 8523 8773 9033 9283 9562 9817 10067 10886 11168"
SEQ_IDs0010="264 514 765 1041 1291 1627 1877 2156 2776 3026"




DATASET="kitti360"
idx=0
for SCENE_ID in $SCENE_IDs
do
    
    SEQ_IDs=$(eval echo \${SEQ_IDs$SCENE_ID})

    echo "Processing scene $SCENE_ID with sequence IDs: $SEQ_IDs"

    for SEQ_ID in $SEQ_IDs
    do

        echo "Processing sequence $SEQ_ID from scene $SCENE_ID"

        #FOV_LIDAR="2.0 13.45 -11.45 13.45"
        #Z_OFFSETS="-0.5 0.0"
        #FOV_LIDAR="2.02984126984 11.0317460317 -8.799812 16.541"
        #Z_OFFSETS="-0.202 -0.121"

        FOV_LIDAR="1.9647572 11.0334425 -8.979475  16.52717"
        Z_OFFSETS="-0.20287499 -0.12243641"

        laser_offsets=" 0.0101472   0.02935141 -0.04524597  0.04477938 -0.00623795  0.04855699 
        -0.02581356 -0.00632023  0.00133613  0.05607248  0.00494516  0.00062785
        0.03141189  0.02682017  0.01036519  0.02891498 -0.01124913  0.04208804
        -0.0218643   0.00743873 -0.01018788 -0.01669445  0.00017374  0.0048293
        0.03166919  0.03558188  0.01552001 -0.03950449  0.00887087  0.04522041
        -0.04557779  0.01275884  0.02858396  0.06113308  0.03508026 -0.07183428
        -0.10038704  0.02749107  0.0291795  -0.03833354 -0.07382096 -0.14437623
        -0.09460489 -0.0584761   0.01881664 -0.02696179 -0.02052307 -0.15732896
        -0.03719316 -0.00687183  0.07373429  0.03398049  0.04429062 -0.05352834
        -0.07988049 -0.02726229 -0.00934669  0.09552395  0.0850026  -0.00946006
        -0.05684165  0.0798225   0.10324192  0.08222152"

        python -m data.preprocess.generate_rangeview --dataset $DATASET --sequence_id $SEQ_ID --scene_id "$SCENE_ID" --fov_lidar $FOV_LIDAR --z_offsets $Z_OFFSETS --laser_offsets $laser_offsets 
    
        python -m data.preprocess.kitti360_to_nerf --sequence_id $SEQ_ID --scene_id "$SCENE_ID"

        python -m data.preprocess.cal_seq_config --dataset $DATASET --sequence_id $SEQ_ID --scene_id "$SCENE_ID" --fov_lidar $FOV_LIDAR --z_offsets $Z_OFFSETS --laser_offsets $laser_offsets

    done
    python -m data.preprocess.generate_mask --scene_id "$SCENE_ID" 
    python -m data.preprocess.generate_intensitymask --scene_id "$SCENE_ID"
    tar -cvf train_$SCENE_ID.tar data/kitti360/train_$SCENE_ID/*
    mv /home/oq55olys/Projects/neural_rendering/LiDAR4D/train_$SCENE_ID.tar ~/Cluster/LiDAR4D/
done

    cp /home/oq55olys/Projects/neural_rendering/LiDAR4D/data/kitti360/*.json ~/Cluster/LiDAR4D/data/kitti360/
    cp /home/oq55olys/Projects/neural_rendering/LiDAR4D/configs/*.txt ~/Cluster/LiDAR4D/configs/

